---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  dev = "svg",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# echos

<!-- badges: start -->
[![Lifecycle: experimental](https://img.shields.io/badge/lifecycle-experimental-orange.svg)](https://www.tidyverse.org/lifecycle/#experimental)
[![Licence](https://img.shields.io/badge/licence-GPL--3-blue.svg)](https://www.gnu.org/licenses/gpl-3.0.en.html)
<!-- badges: end -->

The package provides a tidy interface for modeling and forecasting univariate time series using Echo State Networks (ESNs). The model works within the `fable` framework provided by the `fabletools` package, which provides the tools to evaluate, visualize, and combine models in a workflow consistent with the tidyverse.

***Disclaimer:*** The `echos` package is highly experimental and it is very likely that there will be (substantial) changes in the near future. These changes will probably affect the interface (e.g. arguments within `ESN()`) and the underlying modeling procedure itself.


## Installation

You can install the development version from [GitHub](https://github.com/) with:

``` r
# install.packages("devtools")
devtools::install_github("ahaeusser/echos")
```
## Usage

### Load packages
```{r packages, warning=FALSE, message=FALSE}
library(echos)
library(tscv)
library(dplyr)
library(tsibble)
library(fabletools)
library(fable)
```

```{r abbreviations, echo=FALSE, warning=FALSE, message=FALSE, results='hide'}
Sys.setlocale("LC_TIME", "C")
```

### Prepare data
```{r data}

# Prepare dataset
data <- elec_price %>%
  tscv::clean_data()

# Setup for time series cross validation
n_init <- 2400   # size for training window
n_ahead <- 24    # size for testing window (forecast horizon)
mode <- "slide"  # fixed window approach
n_skip <- 23     # skip 23 observations
n_lag <- 0       # no lag

data <- data %>%
  tscv::split_data(
    n_init = n_init,
    n_ahead = n_ahead,
    mode = mode,
    n_skip = n_skip,
    n_lag = n_lag)

# Use only a small sample of data
data <- data %>%
  filter(BZN == "DE") %>%
  filter(split == 10)

data
```

### Model
```{r model}
# Train models
models <- data %>%
  filter(sample == "train") %>%
  model(
    "ESN" = ESN(Value, lags = list(c(1, 2, 3, 24, 168))),
    "sNaive" = SNAIVE(Value ~ lag("week")))

models

# Detailed report of ESN for split 10
models %>%
  select(ESN) %>%
  report()

```

### Forecast
```{r forecast}
# Forecast models
fcst <- models %>%
  forecast(h = n_ahead)

fcst
```

### Visualize
```{r plot}
tscv::plot_forecast(
  fcst = fcst,         # forecasts as fable
  data = data,         # training and test data
  split = 10,          # only split 10 is visualized
  include = 48)        # plot only the last 48 observations of training data

```


## Work in Progress

* Implement further functions
  + `refit.ESN()`
  + `generate.ESN()`
  + `stream.ESN()`
  + `reservoir.ESN()`
  + `plot_reservoir()`
  + ...
* Enhance `ESN()` to multivariate time series
