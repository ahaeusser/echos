---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  dev = "svg",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# echos

<!-- badges: start -->
[![Lifecycle: experimental](https://img.shields.io/badge/lifecycle-experimental-orange.svg)](https://www.tidyverse.org/lifecycle/#experimental)
<!-- badges: end -->

This package provides a tidy R interface for modeling and forecasting univariate time series using Echo State Networks (ESNs). The model works within the `fable` framework provided by the `fabletools` package, which provides the tools to evaluate, visualise, and combine models in a workflow consistent with the tidyverse.

## Installation

You can install the development version from [GitHub](https://github.com/) with:

``` r
# install.packages("devtools")
devtools::install_github("ahaeusser/echos")
```
## Usage

### Load packages
```{r packages, warning=FALSE, message=FALSE}
library(echos)
library(tscv)
library(dplyr)
library(tsibble)
library(fabletools)
library(fable)
Sys.setlocale("LC_TIME", "C")
```

### Prepare data
```{r data}

# Prepare dataset
data <- elec_price %>%
  tscv::clean_data()

# Setup for time series cross validation
n_init <- 2400   # size for training window
n_ahead <- 24    # size for testing window (forecast horizon)
mode <- "slide"  # fixed window approach
n_skip <- 23     # skip 23 observations
n_lag <- 0       # no lag

data <- data %>%
  tscv::split_data(
    n_init = n_init,
    n_ahead = n_ahead,
    mode = mode,
    n_skip = n_skip,
    n_lag = n_lag)

# Use only a small sample of data
data <- data %>%
  filter(BZN == "SE1") %>%
  filter(split == 10)

data
```

### Model
```{r model}
# Train models
models <- data %>%
  filter(sample == "train") %>%
  model(
    "ESN" = ESN(
      Value,
      inf_crit = "BIC",
      max_lag = 6,
      n_fourier = c(3, 3),
      n_initial = 50,
      n_res = 200,
      scale_inputs = c(-1, 1)),
    "sNaive" = SNAIVE(Value ~ lag("week")))

models

# Detailed report of ESN
models %>%
  select(ESN) %>%
  report()

```

### Forecast
```{r forecast}
# Forecast models
fcsts <- models %>%
  forecast(h = n_ahead)

fcsts
```

### Visualize
```{r plot}
actuals <- data %>%
  filter_index("2019-04-10" ~ .)

fcsts %>%
  autoplot(
    actuals,
    level = NULL,
    size = 1)
```


## Work in Progress

* Implement specials
  + `const()` - intercept term
  + `lags()` - autoregressive lags
  + `fourier()` - fourier terms (trigonometric terms) for seasonality
  + `xreg()` - exogenuous regressors
* Implement further functions
  + `refit.ESN()`
  + `generate.ESN()`
  + `stream.ESN()`
  + `reservoir.ESN()`
  + `plot_reservoir()`
  + ...
* Enhance `ESN()` to mulitvariate time series
