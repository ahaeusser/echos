<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Base functions • echos</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Base functions">
<meta property="og:description" content="echos">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">echos</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.4</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/vignette_01_baseR.html">Base functions</a>
    </li>
    <li>
      <a href="../articles/vignette_02_tidyR.html">Tidy functions</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/ahaeusser/echos/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Base functions</h1>
                        <h4 data-toc-skip class="author">Alexander
Häußer</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ahaeusser/echos/blob/HEAD/vignettes/vignette_01_baseR.Rmd" class="external-link"><code>vignettes/vignette_01_baseR.Rmd</code></a></small>
      <div class="hidden name"><code>vignette_01_baseR.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="load-package">Load package<a class="anchor" aria-label="anchor" href="#load-package"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/ahaeusser/echos" class="external-link">echos</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="prepare-dataset">Prepare dataset<a class="anchor" aria-label="anchor" href="#prepare-dataset"></a>
</h2>
<p>In a first example, we want to model the well-known
<code>AirPassenger</code> time series (<code>ts</code> object). The
dataset contains monthly totals of international airline passengers (in
thousands) from January 1949 to December 1960 with 144 observations in
total. The first 132 observations are used for model training
(<code>n_train</code>) and last 12 observations are used for testing
(<code>n_ahead</code>). <code>xtrain</code> and <code>xtest</code> are
numeric vectors containing the training and testing data.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Forecast horizon</span></span>
<span><span class="va">n_ahead</span> <span class="op">&lt;-</span> <span class="fl">12</span></span>
<span><span class="co"># Number of observations (total)</span></span>
<span><span class="va">n_obs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">AirPassengers</span><span class="op">)</span></span>
<span><span class="co"># Number of observations (training data)</span></span>
<span><span class="va">n_train</span> <span class="op">&lt;-</span> <span class="va">n_obs</span> <span class="op">-</span> <span class="va">n_ahead</span></span>
<span></span>
<span><span class="co"># Prepare train and test data as numeric vectors</span></span>
<span><span class="va">xtrain</span> <span class="op">&lt;-</span> <span class="va">AirPassengers</span><span class="op">[</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">n_train</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">xtest</span> <span class="op">&lt;-</span> <span class="va">AirPassengers</span><span class="op">[</span><span class="op">(</span><span class="op">(</span><span class="va">n_train</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">:</span><span class="va">n_obs</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="va">xtrain</span></span>
<span><span class="co">#&gt;   [1] 112 118 132 129 121 135 148 148 136 119 104 118 115 126 141 135 125 149</span></span>
<span><span class="co">#&gt;  [19] 170 170 158 133 114 140 145 150 178 163 172 178 199 199 184 162 146 166</span></span>
<span><span class="co">#&gt;  [37] 171 180 193 181 183 218 230 242 209 191 172 194 196 196 236 235 229 243</span></span>
<span><span class="co">#&gt;  [55] 264 272 237 211 180 201 204 188 235 227 234 264 302 293 259 229 203 229</span></span>
<span><span class="co">#&gt;  [73] 242 233 267 269 270 315 364 347 312 274 237 278 284 277 317 313 318 374</span></span>
<span><span class="co">#&gt;  [91] 413 405 355 306 271 306 315 301 356 348 355 422 465 467 404 347 305 336</span></span>
<span><span class="co">#&gt; [109] 340 318 362 348 363 435 491 505 404 359 310 337 360 342 406 396 420 472</span></span>
<span><span class="co">#&gt; [127] 548 559 463 407 362 405</span></span>
<span><span class="va">xtest</span></span>
<span><span class="co">#&gt;  [1] 417 391 419 461 472 535 622 606 508 461 390 432</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="train-esn-model">Train ESN model<a class="anchor" aria-label="anchor" href="#train-esn-model"></a>
</h2>
<p>The function <code><a href="../reference/train_esn.html">train_esn()</a></code> is used to automatically train
an ESN to the input data <code>xtrain</code>, where the output
<code>xmodel</code> is an object of class <code>esn</code>. The object
<code>xmodel</code> is a list containing the <code>actual</code> and
<code>fitted</code> values, <code>residuals</code>, the internal states
<code>states_train</code>, estimated coefficients from the ridge
regression estimation, hyperparameters, etc. We can summarize the model
by using the generic S3 method <code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code> to get detailed
information on the trained model.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Train ESN model</span></span>
<span><span class="va">xmodel</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/train_esn.html">train_esn</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">xtrain</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot actual and fitted values</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">xmodel</span><span class="op">$</span><span class="va">actual</span>, type <span class="op">=</span> <span class="st">"l"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">xmodel</span><span class="op">$</span><span class="va">fitted</span>, col <span class="op">=</span> <span class="st">"steelblue"</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="vignette_01_baseR_files/figure-html/model-1.png" width="672"></p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Summarize model</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">xmodel</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; --- Inputs -----------------------------------------------------</span></span>
<span><span class="co">#&gt; n_obs        = 132</span></span>
<span><span class="co">#&gt; n_diff       = 1</span></span>
<span><span class="co">#&gt; lags         = 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; --- Reservoir generation ---------------------------------------</span></span>
<span><span class="co">#&gt; n_states     = 52</span></span>
<span><span class="co">#&gt; alpha        = 1</span></span>
<span><span class="co">#&gt; rho          = 1</span></span>
<span><span class="co">#&gt; density      = 0.5</span></span>
<span><span class="co">#&gt; scale_inputs = [-0.5, 0.5]</span></span>
<span><span class="co">#&gt; scale_win    = [-0.5, 0.5]</span></span>
<span><span class="co">#&gt; scale_wres   = [-0.5, 0.5]</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; --- Model selection --------------------------------------------</span></span>
<span><span class="co">#&gt; n_models     = 104</span></span>
<span><span class="co">#&gt; df           = 18.61</span></span>
<span><span class="co">#&gt; lambda       = 0.008</span></span></code></pre></div>
<p>From the output above, we get the following information about the
trained ESN model:</p>
<table class="table">
<colgroup>
<col width="13%">
<col width="86%">
</colgroup>
<thead><tr class="header">
<th align="left">Value</th>
<th align="left">Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left"><code>n_obs</code></td>
<td align="left">Number of observations (i.e., length of the input time
series)</td>
</tr>
<tr class="even">
<td align="left"><code>n_diff</code></td>
<td align="left">Number of differences required to achieve (weak-)
stationarity of the input training data</td>
</tr>
<tr class="odd">
<td align="left"><code>lags</code></td>
<td align="left">Lags of the output variable (response), which are used
as model input</td>
</tr>
<tr class="even">
<td align="left"><code>n_states</code></td>
<td align="left">Number of internal states (i.e., predictor variables or
reservoir size).</td>
</tr>
<tr class="odd">
<td align="left"><code>alpha</code></td>
<td align="left">Leakage rate (smoothing parameter)</td>
</tr>
<tr class="even">
<td align="left"><code>rho</code></td>
<td align="left">Spectral radius for scaling the reservoir weight
matrix</td>
</tr>
<tr class="odd">
<td align="left"><code>density</code></td>
<td align="left">Density of the reservoir weight matrix</td>
</tr>
<tr class="even">
<td align="left"><code>scale_inputs</code></td>
<td align="left">Input training data are scaled to the interval
<code>(-0.5, 0.5)</code>
</td>
</tr>
<tr class="odd">
<td align="left"><code>scale_win</code></td>
<td align="left">Input weights matrix is drawn from a random uniform
distribution with interval <code>(-0.5, 0.5)</code>
</td>
</tr>
<tr class="even">
<td align="left"><code>scale_wres</code></td>
<td align="left">Reservoir weight matrix is drawn from a random uniform
distribution with interval <code>(-0.5, 0.5)</code>
</td>
</tr>
<tr class="odd">
<td align="left"><code>n_models</code></td>
<td align="left">Number of models evaluated during the random search
optimization to find the regularization parameter
<code>lambda</code>
</td>
</tr>
<tr class="even">
<td align="left"><code>df</code></td>
<td align="left">Effective degrees of freedom in the model</td>
</tr>
<tr class="odd">
<td align="left"><code>lambda</code></td>
<td align="left">Regularization parameter for the ridge regression
estimation</td>
</tr>
</tbody>
</table>
<!-- * Layers --><!--   * `n_inputs`: Number of input variables --><!--   * `n_states`: Number of internal states (i.e., the reservoir size). The internal states are the actual predictor variables in the model. --><!--   * `n_outputs`: Number of output variables (i.e., response variables) --><!-- * Meta --><!--   * `lags`: Lags of the output variable, which are used as model input --><!--   * `n_diff`: Number of differences required to achieve (weak-) stationarity of the input training data --><!--   * `n_models`: Number of models evaluated during the random search optimization to find the regularization parameter `lambda` --><!-- * Scaling --><!--   * `scale_inputs`: Input training data are scaled to the interval `(-0.5, 0.5)` --><!--   * `scale_win`: Input weights matrix is drawn from a random uniform distribution with interval `(-0.5, 0.5)` --><!--   * `scale_wres`: Reservoir weight matrix is drawn from a random uniform distribution with interval `(-0.5, 0.5)` --><!-- * Hyperparameters: --><!--   * `alpha`: Leakage rate (smoothing parameter) --><!--   * `rho`: Spectral radius for scaling the reservoir weight matrix --><!--   * `lambda`: Regularization parameter for the ridge regression estimation --><!--   * `density`: The density of the reservoir weight matrix -->
</div>
<div class="section level2">
<h2 id="forecast-esn-model">Forecast ESN model<a class="anchor" aria-label="anchor" href="#forecast-esn-model"></a>
</h2>
<p>The function <code><a href="../reference/forecast_esn.html">forecast_esn()</a></code> is used to forecast the
trained model <code>xmodel</code> for <code>n_ahead</code> steps into
the future. The output <code>xfcst</code> is a list of class
<code>forecast_esn</code> containing the <code>point</code> forecasts,
<code>actual</code> and <code>fitted</code> values, the forecast horizon
<code>n_ahead</code> and the model specification
<code>model_spec</code>. We can use the generic S3 method
<code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code> to visualize the point forecast within
<code>xfcst</code> and add the holdout test data <code>xtest</code>.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Forecast ESN model</span></span>
<span><span class="va">xfcst</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/forecast_esn.html">forecast_esn</a></span><span class="op">(</span><span class="va">xmodel</span>, n_ahead <span class="op">=</span> <span class="va">n_ahead</span><span class="op">)</span></span>
<span><span class="va">xfcst</span></span>
<span><span class="co">#&gt; $point</span></span>
<span><span class="co">#&gt;  [1] 417.1882 394.6582 442.8875 432.9793 466.5263 522.0339 594.8509 601.8089</span></span>
<span><span class="co">#&gt;  [9] 501.4787 445.6808 400.5648 438.0486</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $actual</span></span>
<span><span class="co">#&gt;   [1]  NA  NA  NA  NA  NA  NA  NA  NA 136 119 104 118 115 126 141 135 125 149</span></span>
<span><span class="co">#&gt;  [19] 170 170 158 133 114 140 145 150 178 163 172 178 199 199 184 162 146 166</span></span>
<span><span class="co">#&gt;  [37] 171 180 193 181 183 218 230 242 209 191 172 194 196 196 236 235 229 243</span></span>
<span><span class="co">#&gt;  [55] 264 272 237 211 180 201 204 188 235 227 234 264 302 293 259 229 203 229</span></span>
<span><span class="co">#&gt;  [73] 242 233 267 269 270 315 364 347 312 274 237 278 284 277 317 313 318 374</span></span>
<span><span class="co">#&gt;  [91] 413 405 355 306 271 306 315 301 356 348 355 422 465 467 404 347 305 336</span></span>
<span><span class="co">#&gt; [109] 340 318 362 348 363 435 491 505 404 359 310 337 360 342 406 396 420 472</span></span>
<span><span class="co">#&gt; [127] 548 559 463 407 362 405</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $fitted</span></span>
<span><span class="co">#&gt;   [1]       NA       NA       NA       NA       NA       NA       NA       NA</span></span>
<span><span class="co">#&gt;   [9] 145.7164 127.3081 112.9902 107.0054 118.1469 115.5302 142.5219 138.9433</span></span>
<span><span class="co">#&gt;  [17] 129.7828 137.3497 172.5977 173.7693 155.8541 132.5665 124.1381 129.5666</span></span>
<span><span class="co">#&gt;  [25] 144.8099 155.8602 170.5424 162.8141 155.4332 191.6271 204.9483 197.0546</span></span>
<span><span class="co">#&gt;  [33] 182.6689 163.4202 140.9553 175.9001 168.9458 179.7858 208.1735 184.3650</span></span>
<span><span class="co">#&gt;  [41] 183.8114 198.8734 241.8025 230.0927 218.7145 180.2839 176.2637 195.8239</span></span>
<span><span class="co">#&gt;  [49] 203.9867 197.7465 221.0399 216.4082 246.2847 254.5426 258.8691 268.9379</span></span>
<span><span class="co">#&gt;  [57] 247.7433 210.3665 194.9113 205.2524 212.9219 207.5823 242.1780 234.1873</span></span>
<span><span class="co">#&gt;  [65] 237.4439 253.0441 290.5464 315.0828 254.9987 224.3264 200.0762 234.5009</span></span>
<span><span class="co">#&gt;  [73] 226.7226 228.5192 275.3030 262.7540 269.5059 305.0020 350.6129 352.7342</span></span>
<span><span class="co">#&gt;  [81] 297.1616 273.0064 244.0305 269.6008 281.1636 279.6552 310.1817 313.0442</span></span>
<span><span class="co">#&gt;  [89] 313.4519 359.4934 425.4337 400.7056 354.8856 310.7771 271.7869 307.7336</span></span>
<span><span class="co">#&gt;  [97] 318.1456 306.4374 342.0817 352.6253 356.3302 406.1027 462.7193 455.0442</span></span>
<span><span class="co">#&gt; [105] 408.8471 348.9001 308.4295 338.2909 349.0748 325.6744 374.0811 357.6986</span></span>
<span><span class="co">#&gt; [113] 367.5063 435.6384 494.8804 493.7509 438.1065 346.7945 317.9420 343.7900</span></span>
<span><span class="co">#&gt; [121] 351.9400 328.7802 394.5666 387.2260 417.2922 480.4603 531.8839 554.0935</span></span>
<span><span class="co">#&gt; [129] 465.7218 409.5529 355.9789 386.6106</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $n_ahead</span></span>
<span><span class="co">#&gt; [1] 12</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $model_spec</span></span>
<span><span class="co">#&gt; [1] "ESN({132, 52, 104}, {18.61, 0.008})"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; attr(,"class")</span></span>
<span><span class="co">#&gt; [1] "forecast_esn"</span></span>
<span></span>
<span><span class="co"># Plot forecast and test data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">xfcst</span>, test <span class="op">=</span> <span class="va">xtest</span><span class="op">)</span></span></code></pre></div>
<p><img src="vignette_01_baseR_files/figure-html/forecast-1.png" width="672"></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Alexander Häußer.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
