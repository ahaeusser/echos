<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Base functions • echos</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Base functions">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">echos</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/vignette_01_baseR.html">Base functions</a></li>
    <li><a class="dropdown-item" href="../articles/vignette_02_tidyR.html">Tidy functions</a></li>
    <li><a class="dropdown-item" href="../articles/vignette_03_datasets.html">Datasets</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ahaeusser/echos/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Base functions</h1>
                        <h4 data-toc-skip class="author">Alexander
Häußer</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ahaeusser/echos/blob/HEAD/vignettes/vignette_01_baseR.Rmd" class="external-link"><code>vignettes/vignette_01_baseR.Rmd</code></a></small>
      <div class="d-none name"><code>vignette_01_baseR.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="load-package">Load package<a class="anchor" aria-label="anchor" href="#load-package"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/ahaeusser/echos" class="external-link">echos</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="prepare-dataset">Prepare dataset<a class="anchor" aria-label="anchor" href="#prepare-dataset"></a>
</h2>
<p>In a first example, we want to model the well-known
<code>AirPassenger</code> time series (<code>ts</code> object). The
dataset contains monthly totals of international airline passengers (in
thousands) from January 1949 to December 1960 with 144 observations in
total. The first 132 observations are used for model training
(<code>n_train</code>) and last 12 observations are used for testing
(<code>n_ahead</code>). <code>xtrain</code> and <code>xtest</code> are
numeric vectors containing the training and testing data.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Forecast horizon</span></span>
<span><span class="va">n_ahead</span> <span class="op">&lt;-</span> <span class="fl">12</span></span>
<span><span class="co"># Number of observations (total)</span></span>
<span><span class="va">n_obs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">AirPassengers</span><span class="op">)</span></span>
<span><span class="co"># Number of observations (training data)</span></span>
<span><span class="va">n_train</span> <span class="op">&lt;-</span> <span class="va">n_obs</span> <span class="op">-</span> <span class="va">n_ahead</span></span>
<span></span>
<span><span class="co"># Prepare train and test data as numeric vectors</span></span>
<span><span class="va">xtrain</span> <span class="op">&lt;-</span> <span class="va">AirPassengers</span><span class="op">[</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">n_train</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">xtest</span> <span class="op">&lt;-</span> <span class="va">AirPassengers</span><span class="op">[</span><span class="op">(</span><span class="op">(</span><span class="va">n_train</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">:</span><span class="va">n_obs</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="va">xtrain</span></span>
<span><span class="co">#&gt;   [1] 112 118 132 129 121 135 148 148 136 119 104 118 115 126 141 135 125 149</span></span>
<span><span class="co">#&gt;  [19] 170 170 158 133 114 140 145 150 178 163 172 178 199 199 184 162 146 166</span></span>
<span><span class="co">#&gt;  [37] 171 180 193 181 183 218 230 242 209 191 172 194 196 196 236 235 229 243</span></span>
<span><span class="co">#&gt;  [55] 264 272 237 211 180 201 204 188 235 227 234 264 302 293 259 229 203 229</span></span>
<span><span class="co">#&gt;  [73] 242 233 267 269 270 315 364 347 312 274 237 278 284 277 317 313 318 374</span></span>
<span><span class="co">#&gt;  [91] 413 405 355 306 271 306 315 301 356 348 355 422 465 467 404 347 305 336</span></span>
<span><span class="co">#&gt; [109] 340 318 362 348 363 435 491 505 404 359 310 337 360 342 406 396 420 472</span></span>
<span><span class="co">#&gt; [127] 548 559 463 407 362 405</span></span>
<span><span class="va">xtest</span></span>
<span><span class="co">#&gt;  [1] 417 391 419 461 472 535 622 606 508 461 390 432</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="train-esn-model">Train ESN model<a class="anchor" aria-label="anchor" href="#train-esn-model"></a>
</h2>
<p>The function <code><a href="../reference/train_esn.html">train_esn()</a></code> is used to automatically train
an ESN to the input data <code>xtrain</code>, where the output
<code>xmodel</code> is an object of class <code>esn</code>. The object
<code>xmodel</code> is a list containing the <code>actual</code> and
<code>fitted</code> values, <code>residuals</code>, the internal states
<code>states_train</code>, estimated coefficients from the ridge
regression estimation, hyperparameters, etc. We can summarize the model
by using the generic S3 method <code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code> to get detailed
information on the trained model.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Train ESN model</span></span>
<span><span class="va">xmodel</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/train_esn.html">train_esn</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">xtrain</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot actual and fitted values</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">xmodel</span><span class="op">$</span><span class="va">actual</span>, type <span class="op">=</span> <span class="st">"l"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">xmodel</span><span class="op">$</span><span class="va">fitted</span>, col <span class="op">=</span> <span class="st">"steelblue"</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="vignette_01_baseR_files/figure-html/model-1.png" alt="Plot actual and fitted values" width="672"></p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Summarize model</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">xmodel</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; --- Inputs -----------------------------------------------------</span></span>
<span><span class="co">#&gt; n_obs        = 132</span></span>
<span><span class="co">#&gt; n_diff       = 1</span></span>
<span><span class="co">#&gt; lags         = 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; --- Reservoir generation ---------------------------------------</span></span>
<span><span class="co">#&gt; n_states     = 52</span></span>
<span><span class="co">#&gt; alpha        = 1</span></span>
<span><span class="co">#&gt; rho          = 0.95</span></span>
<span><span class="co">#&gt; density      = 0.5</span></span>
<span><span class="co">#&gt; scale_inputs = [-0.5, 0.5]</span></span>
<span><span class="co">#&gt; scale_win    = [-0.5, 0.5]</span></span>
<span><span class="co">#&gt; scale_wres   = [-0.5, 0.5]</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; --- Model selection --------------------------------------------</span></span>
<span><span class="co">#&gt; n_models     = 104</span></span>
<span><span class="co">#&gt; df           = 17.33</span></span>
<span><span class="co">#&gt; lambda       = 0.0032</span></span></code></pre></div>
<p>From the output above, we get the following information about the
trained ESN model:</p>
<table class="table">
<colgroup>
<col width="13%">
<col width="86%">
</colgroup>
<thead><tr class="header">
<th align="left">Value</th>
<th align="left">Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left"><code>n_obs</code></td>
<td align="left">Number of observations (i.e., length of the input time
series)</td>
</tr>
<tr class="even">
<td align="left"><code>n_diff</code></td>
<td align="left">Number of differences required to achieve (weak-)
stationarity of the input training data</td>
</tr>
<tr class="odd">
<td align="left"><code>lags</code></td>
<td align="left">Lags of the output variable (response), which are used
as model input</td>
</tr>
<tr class="even">
<td align="left"><code>n_states</code></td>
<td align="left">Number of internal states (i.e., predictor variables or
reservoir size).</td>
</tr>
<tr class="odd">
<td align="left"><code>alpha</code></td>
<td align="left">Leakage rate (smoothing parameter)</td>
</tr>
<tr class="even">
<td align="left"><code>rho</code></td>
<td align="left">Spectral radius for scaling the reservoir weight
matrix</td>
</tr>
<tr class="odd">
<td align="left"><code>density</code></td>
<td align="left">Density of the reservoir weight matrix</td>
</tr>
<tr class="even">
<td align="left"><code>scale_inputs</code></td>
<td align="left">Input training data are scaled to the interval
<code>(-0.5, 0.5)</code>
</td>
</tr>
<tr class="odd">
<td align="left"><code>scale_win</code></td>
<td align="left">Input weights matrix is drawn from a random uniform
distribution with interval <code>(-0.5, 0.5)</code>
</td>
</tr>
<tr class="even">
<td align="left"><code>scale_wres</code></td>
<td align="left">Reservoir weight matrix is drawn from a random uniform
distribution with interval <code>(-0.5, 0.5)</code>
</td>
</tr>
<tr class="odd">
<td align="left"><code>n_models</code></td>
<td align="left">Number of models evaluated during the random search
optimization to find the regularization parameter
<code>lambda</code>
</td>
</tr>
<tr class="even">
<td align="left"><code>df</code></td>
<td align="left">Effective degrees of freedom in the model</td>
</tr>
<tr class="odd">
<td align="left"><code>lambda</code></td>
<td align="left">Regularization parameter for the ridge regression
estimation</td>
</tr>
</tbody>
</table>
</div>
<div class="section level2">
<h2 id="forecast-esn-model">Forecast ESN model<a class="anchor" aria-label="anchor" href="#forecast-esn-model"></a>
</h2>
<p>The function <code><a href="../reference/forecast_esn.html">forecast_esn()</a></code> is used to forecast the
trained model <code>xmodel</code> for <code>n_ahead</code> steps into
the future. The output <code>xfcst</code> is a list of class
<code>forecast_esn</code> containing the <code>point</code> forecasts,
<code>actual</code> and <code>fitted</code> values, the forecast horizon
<code>n_ahead</code> and the model specification
<code>model_spec</code>. We can use the generic S3 method
<code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code> to visualize the point forecast within
<code>xfcst</code> and add the holdout test data <code>xtest</code>.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Forecast ESN model</span></span>
<span><span class="va">xfcst</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/forecast_esn.html">forecast_esn</a></span><span class="op">(</span><span class="va">xmodel</span>, n_ahead <span class="op">=</span> <span class="va">n_ahead</span><span class="op">)</span></span>
<span><span class="va">xfcst</span></span>
<span><span class="co">#&gt; $point</span></span>
<span><span class="co">#&gt;  [1] 420.1502 401.4111 450.4424 440.6994 467.7241 516.4456 591.9815 601.8765</span></span>
<span><span class="co">#&gt;  [9] 504.3060 450.0242 403.1496 440.3876</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $actual</span></span>
<span><span class="co">#&gt;   [1]  NA  NA  NA  NA  NA  NA  NA  NA 136 119 104 118 115 126 141 135 125 149</span></span>
<span><span class="co">#&gt;  [19] 170 170 158 133 114 140 145 150 178 163 172 178 199 199 184 162 146 166</span></span>
<span><span class="co">#&gt;  [37] 171 180 193 181 183 218 230 242 209 191 172 194 196 196 236 235 229 243</span></span>
<span><span class="co">#&gt;  [55] 264 272 237 211 180 201 204 188 235 227 234 264 302 293 259 229 203 229</span></span>
<span><span class="co">#&gt;  [73] 242 233 267 269 270 315 364 347 312 274 237 278 284 277 317 313 318 374</span></span>
<span><span class="co">#&gt;  [91] 413 405 355 306 271 306 315 301 356 348 355 422 465 467 404 347 305 336</span></span>
<span><span class="co">#&gt; [109] 340 318 362 348 363 435 491 505 404 359 310 337 360 342 406 396 420 472</span></span>
<span><span class="co">#&gt; [127] 548 559 463 407 362 405</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $fitted</span></span>
<span><span class="co">#&gt;   [1]       NA       NA       NA       NA       NA       NA       NA       NA</span></span>
<span><span class="co">#&gt;   [9] 146.9816 130.4251 115.2509 106.4015 113.9974 112.5610 142.7890 140.6653</span></span>
<span><span class="co">#&gt;  [17] 133.3988 141.2633 171.0034 169.8233 154.6211 131.7167 124.7118 132.2487</span></span>
<span><span class="co">#&gt;  [25] 145.4968 156.1379 169.4113 161.7540 155.3824 192.2825 205.0914 200.0951</span></span>
<span><span class="co">#&gt;  [33] 183.1431 159.1954 137.8381 175.2709 170.2357 182.7745 208.9514 184.6984</span></span>
<span><span class="co">#&gt;  [41] 183.9124 195.9409 239.0134 232.6934 221.4077 182.6306 178.3072 193.2479</span></span>
<span><span class="co">#&gt;  [49] 203.0377 197.7014 218.4362 215.9644 246.6104 255.9783 261.0848 270.9694</span></span>
<span><span class="co">#&gt;  [57] 243.8682 206.4721 193.1341 206.2135 214.0910 209.8160 242.3400 233.8699</span></span>
<span><span class="co">#&gt;  [65] 232.6356 250.2745 290.4984 315.9170 256.9259 227.8865 199.4572 231.2831</span></span>
<span><span class="co">#&gt;  [73] 223.9210 228.0987 276.2045 265.3127 271.5839 306.1690 349.7491 351.2003</span></span>
<span><span class="co">#&gt;  [81] 298.6940 272.4535 244.8644 271.6241 284.0540 277.0195 307.0108 312.7092</span></span>
<span><span class="co">#&gt;  [89] 314.6767 361.8291 425.2601 397.3839 356.3534 308.4159 269.4947 308.7790</span></span>
<span><span class="co">#&gt;  [97] 318.3926 306.9866 344.2847 351.1118 357.1520 406.8810 464.5870 457.2393</span></span>
<span><span class="co">#&gt; [105] 408.0141 348.1398 309.4448 338.0822 348.2789 326.2401 373.0930 356.8166</span></span>
<span><span class="co">#&gt; [113] 367.5198 433.1142 492.1188 495.2549 439.6658 349.3117 319.1499 343.4011</span></span>
<span><span class="co">#&gt; [121] 353.3759 331.1060 392.1569 388.8980 418.5426 479.8462 535.4396 553.2547</span></span>
<span><span class="co">#&gt; [129] 459.6384 409.4199 354.3172 385.6255</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $n_ahead</span></span>
<span><span class="co">#&gt; [1] 12</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $model_spec</span></span>
<span><span class="co">#&gt; [1] "ESN({52, 1, 0.95}, {104, 17.33})"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; attr(,"class")</span></span>
<span><span class="co">#&gt; [1] "forecast_esn"</span></span>
<span></span>
<span><span class="co"># Plot forecast and test data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">xfcst</span>, test <span class="op">=</span> <span class="va">xtest</span><span class="op">)</span></span></code></pre></div>
<p><img src="vignette_01_baseR_files/figure-html/forecast-1.png" alt="Plot forecast and test data" width="672"></p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Alexander Häußer.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.2.</p>
</div>

    </footer>
</div>





  </body>
</html>
